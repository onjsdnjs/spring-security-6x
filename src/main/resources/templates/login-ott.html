<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>OTT Login</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
<div th:insert="fragments/header :: header"></div>
<div th:insert="fragments/menu   :: menu"></div>

<main>
    <div class="container">
        <h2>One-Time Token Login</h2>
        <form id="ottForm">
            <input type="email" id="email" placeholder="Enter your email" required>
            <button type="submit">Send Login Link</button>
        </form>
        <p id="message" class="message" style="display:none;"></p>
        <div class="links">
            <a href="/register">Register</a>
            <a href="/users">Users</a>
        </div>
    </div>
</main>

<div th:insert="fragments/footer :: footer"></div>

<script>
    document.getElementById("ottForm").addEventListener("submit", async e => {
        e.preventDefault();
        const email = document.getElementById("email").value;
        const msg   = document.getElementById("message");
        try {
            const res = await fetch("/ott/generate", {
                method:"POST",
                headers:{"Content-Type":"application/x-www-form-urlencoded"},
                body:new URLSearchParams({ email })
            });
            msg.innerText = res.ok
                ? "Login link sent (simulation)."
                : "Failed to send link.";
        } catch {
            msg.innerText = "Server error.";
        }
        msg.style.display = "block";
    });
</script>
</body>
</html>
